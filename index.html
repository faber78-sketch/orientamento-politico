<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Test di Orientamento Politico â€” completo</title>
<style>
  :root{
    --accent:#003366;
    --bg:#f6f8fb;
    --card:#fff;
    --text:#1c1c1c;
    --muted:#5b6b7a;
  }
  body{margin:0;font-family:"Segoe UI", Roboto, Arial, sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
  header{background:var(--accent);color:#fff;padding:18px;text-align:center}
  header h1{margin:0;font-size:1.4rem}
  main{max-width:1100px;margin:18px auto;padding:18px}
  .intro{background:#eef4fb;border-left:6px solid var(--accent);padding:12px;border-radius:8px;margin-bottom:14px}
  .area{background:var(--card);padding:14px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.06);margin-bottom:14px}
  .area h2{color:var(--accent);margin:0 0 8px 0;font-size:1rem}
  .q{display:flex;flex-wrap:wrap;align-items:center;padding:8px 0;border-top:1px solid #f0f3f6}
  .q:first-of-type{border-top:0}
  .q p{flex:1 1 65%;margin:0;padding-right:8px}
  .q .sel{flex:0 0 32%;text-align:right}
  select{padding:8px;border-radius:6px;border:1px solid #ccd6df;background:#fff}
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0}
  button{background:var(--accent);color:#fff;border:0;padding:10px 14px;border-radius:8px;cursor:pointer}
  button.alt{background:#fff;color:var(--accent);border:1px solid #d7e4f0}
  #result{display:none;margin-top:16px;padding:14px;border-radius:8px;background:#f0f7ff;border-left:6px solid var(--accent)}
  .profileTitle{font-weight:700;color:var(--accent);margin:0 0 8px 0}
  .profileDesc{margin:6px 0}
  .areaSummary{margin:8px 0 0 0;padding-left:1rem}
  footer{margin-top:18px;text-align:center;color:var(--muted);font-size:0.9rem;padding-bottom:20px}
  @media (max-width:800px){ .q p{flex-basis:100%;margin-bottom:8px} .q .sel{flex-basis:100%;text-align:left} }
</style>
</head>
<body>
  <header>
    <h1>ðŸ§­ Test di Orientamento Politico â€” versione completa</h1>
  </header>

  <main>
    <div class="intro">
      <strong>Introduzione</strong>
      <p style="margin:.4rem 0 0">
        Questo test Ã¨ stato progettato per aiutarti a comprendere il tuo orientamento politico complessivo
        in modo scientifico e imparziale. Non Ã¨ un sondaggio elettorale: misura valori e prioritÃ  su 9 aree tematiche.
        Rispondi sinceramente; il risultato fornirÃ  il profilo corrispondente e il profilo piÃ¹ affine (solo descrizioni, senza numeri).
      </p>
      <p style="margin:.4rem 0 0;font-size:.9rem;color:var(--muted)">Durata stimata: 6â€“12 minuti â€” 81 affermazioni (9 aree Ã— 9 affermazioni).</p>
      <p style="margin:.4rem 0 0">
        <a href="metodi.html" style="color:var(--accent);text-decoration:underline">ðŸ“˜ Leggi la metodologia del test</a>
      </p>
    </div>

    <div id="form"></div>

    <div class="controls">
      <button id="calc">Calcola risultato</button>
      <button id="save" class="alt">Salva locale</button>
      <button id="load" class="alt">Carica salvataggio</button>
      <button id="reset" class="alt">Reset</button>
    </div>

    <div id="result" aria-live="polite"></div>

  </main>

  <footer>Â© 2025 â€” Test orientamento politico â€¢ Uso didattico e informativo</footer>

<script>
/* =================== DOMANDE (9 aree Ã— 9 affermazioni = 81) ===================
   Ogni domanda ha id, testo e dir:
   dir = "L" (accordo => orientamento progressista/left; tratto invertito in calcolo)
         "R" (accordo => orientamento conservatore/right)
         "N" (neutrale / non invertita)
============================================================================= */

const areas = [
  /* AREA 1 â€” ECONOMIA E LAVORO */
  { id:1, title:"AREA 1 â€” ECONOMIA E LAVORO", qs:[
    {id:"1_1", text:"Lo Stato deve intervenire attivamente per ridistribuire la ricchezza e ridurre le disuguaglianze sociali.", dir:"L"},
    {id:"1_2", text:"Le tasse sui grandi patrimoni e sui profitti aziendali dovrebbero essere aumentate per finanziare servizi pubblici e welfare.", dir:"L"},
    {id:"1_3", text:"Le privatizzazioni di settori come autostrade, ferrovie o servizi pubblici hanno migliorato lâ€™efficienza economica del Paese.", dir:"R"},
    {id:"1_4", text:"Un salario minimo legale Ã¨ necessario per garantire una retribuzione dignitosa a tutti i lavoratori.", dir:"L"},
    {id:"1_5", text:"Le imprese dovrebbero avere meno vincoli sindacali e normativi per poter essere competitive a livello internazionale.", dir:"R"},
    {id:"1_6", text:"Le cooperative, le piccole e medie imprese e le imprese sociali dovrebbero essere favorite rispetto ai grandi gruppi industriali.", dir:"L"},
    {id:"1_7", text:"Gli incentivi alle aziende dovrebbero essere concessi solo se mantengono livelli stabili di occupazione.", dir:"L"},
    {id:"1_8", text:"Il mercato, e non lo Stato, deve determinare salari, prezzi e condizioni di lavoro.", dir:"R"},
    {id:"1_9", text:"La stabilitÃ  economica di uno Stato dipende soprattutto dalla capacitÃ  di attrarre investimenti privati, piÃ¹ che dallâ€™intervento pubblico nel mercato.", dir:"R"}
  ]},

  /* AREA 2 â€” STATO, TASSE E WELFARE */
  { id:2, title:"AREA 2 â€” STATO, TASSE E WELFARE", qs:[
    {id:"2_1", text:"Lo Stato deve garantire sanitÃ  e istruzione gratuite e di alta qualitÃ  per tutti.", dir:"L"},
    {id:"2_2", text:"Chi guadagna di piÃ¹ dovrebbe contribuire con tasse proporzionalmente piÃ¹ alte.", dir:"L"},
    {id:"2_3", text:"Gli aiuti pubblici come il reddito di cittadinanza o i sussidi di disoccupazione rischiano di creare dipendenza e ridurre la voglia di lavorare.", dir:"R"},
    {id:"2_4", text:"Ãˆ giusto ridurre le tasse anche se ciÃ² comporta tagli ai servizi pubblici come sanitÃ , scuola o trasporti.", dir:"R"},
    {id:"2_5", text:"Misure come il reddito di cittadinanza sono strumenti efficaci per ridurre la povertÃ  e garantire una rete di protezione sociale.", dir:"L"},
    {id:"2_6", text:"I servizi pubblici dovrebbero essere gestiti da aziende private sotto controllo statale.", dir:"R"},
    {id:"2_7", text:"La spesa pubblica per la difesa dovrebbe aumentare.", dir:"R"},
    {id:"2_8", text:"La burocrazia Ã¨ un ostacolo maggiore rispetto alla mancanza di fondi.", dir:"R"},
    {id:"2_9", text:"Lâ€™uguaglianza dei diritti deve essere garantita anche se questo comporta una limitazione di alcune libertÃ  economiche individuali.", dir:"L"}
  ]},

  /* AREA 3 â€” EUROPA E POLITICA ESTERA */
  { id:3, title:"AREA 3 â€” EUROPA E POLITICA ESTERA", qs:[
    {id:"3_1", text:"Lâ€™Italia dovrebbe restare pienamente integrata nellâ€™Unione Europea.", dir:"L"},
    {id:"3_2", text:"Lâ€™euro ha portato piÃ¹ vantaggi che svantaggi.", dir:"L"},
    {id:"3_3", text:"Lâ€™Italia dovrebbe poter violare temporaneamente le regole europee di bilancio per investire in crescita.", dir:"L"},
    {id:"3_4", text:"La NATO Ã¨ una garanzia di sicurezza per lâ€™Italia.", dir:"R"},
    {id:"3_5", text:"Lâ€™Italia dovrebbe adottare una politica estera piÃ¹ autonoma dagli USA.", dir:"L"},
    {id:"3_6", text:"Lâ€™Unione Europea dovrebbe avere una propria difesa comune.", dir:"L"},
    {id:"3_7", text:"Le sanzioni economiche sono uno strumento efficace in politica estera.", dir:"L"},
    {id:"3_8", text:"La sovranitÃ  nazionale deve prevalere su quella europea.", dir:"R"},
    {id:"3_9", text:"La scuola deve formare principalmente cittadini critici e consapevoli, piÃ¹ che lavoratori pronti a inserirsi nel sistema produttivo.", dir:"L"}
  ]},

  /* AREA 4 â€” AMBIENTE E SVILUPPO SOSTENIBILE */
  { id:4, title:"AREA 4 â€” AMBIENTE E SVILUPPO SOSTENIBILE", qs:[
    {id:"4_1", text:"Le politiche ambientali devono essere prioritarie anche se rallentano la crescita economica.", dir:"L"},
    {id:"4_2", text:"Il nucleare Ã¨ una soluzione sostenibile per ridurre le emissioni.", dir:"R"},
    {id:"4_3", text:"Le tasse ambientali dovrebbero colpire le imprese piÃ¹ inquinanti.", dir:"L"},
    {id:"4_4", text:"Lo Stato deve investire di piÃ¹ in energie rinnovabili.", dir:"L"},
    {id:"4_5", text:"Gli agricoltori devono essere sostenuti nella transizione ecologica.", dir:"L"},
    {id:"4_6", text:"Lâ€™ambiente Ã¨ troppo spesso usato come pretesto per nuove tasse.", dir:"R"},
    {id:"4_7", text:"I trasporti pubblici dovrebbero essere potenziati anche a discapito dellâ€™uso dellâ€™auto privata.", dir:"L"},
    {id:"4_8", text:"Le grandi opere infrastrutturali (es. autostrade, porti, impianti industriali) dovrebbero essere realizzate piÃ¹ rapidamente, anche se comportano un impatto ambientale significativo.", dir:"R"},
    {id:"4_9", text:"Ãˆ giusto rinunciare a parte del benessere materiale pur di ridurre drasticamente lâ€™impatto ambientale delle attivitÃ  umane.", dir:"L"}
  ]},

  /* AREA 5 â€” IMMIGRAZIONE E IDENTITÃ€ */
  { id:5, title:"AREA 5 â€” IMMIGRAZIONE E IDENTITÃ€", qs:[
    {id:"5_1", text:"Lâ€™immigrazione Ã¨ una risorsa economica e culturale.", dir:"L"},
    {id:"5_2", text:"Lâ€™Italia deve accogliere solo chi ha effettivo diritto allâ€™asilo secondo le convenzioni internazionali.", dir:"R"},
    {id:"5_3", text:"Lo ius soli (cittadinanza ai nati in Italia) va approvato.", dir:"L"},
    {id:"5_4", text:"Gli stranieri devono integrarsi rispettando la nostra cultura e le nostre leggi.", dir:"R"},
    {id:"5_5", text:"Lâ€™Italia dovrebbe accogliere anche chi fugge da povertÃ  o instabilitÃ  politica, non solo chi ha diritto dâ€™asilo.", dir:"L"},
    {id:"5_6", text:"La presenza di immigrati aumenta lâ€™insicurezza.", dir:"R"},
    {id:"5_7", text:"Lâ€™Italia deve contribuire a un sistema europeo di redistribuzione dei migranti.", dir:"L"},
    {id:"5_8", text:"Lâ€™identitÃ  italiana Ã¨ messa a rischio dalla diffusione della cucina etnica (es. sushi, kebab) e dalla globalizzazione culturale.", dir:"R"},
    {id:"5_9", text:"La cultura nazionale deve prevalere sulle influenze esterne, anche a costo di limitare lâ€™espressione artistica e linguistica globale.", dir:"R"}
  ]},

  /* AREA 6 â€” DIRITTI CIVILI E SOCIETÃ€ (righe adeguate; ex Giustizia/Sicurezza) */
  { id:6, title:"AREA 6 â€” GIUSTIZIA, SICUREZZA E LEGALITÃ€", qs:[
    {id:"6_1", text:"Le pene devono essere piÃ¹ severe per reati gravi.", dir:"R"},
    {id:"6_2", text:"La certezza della pena Ã¨ piÃ¹ importante della rieducazione.", dir:"R"},
    {id:"6_3", text:"Le leggi dello Stato dovrebbero ispirarsi ai valori religiosi o morali condivisi dalla maggioranza.", dir:"R"},
    {id:"6_4", text:"Lo Stato dovrebbe investire di piÃ¹ nella prevenzione sociale (scuola, lavoro, inclusione) piuttosto che nel carcere.", dir:"L"},
    {id:"6_5", text:"Le forze dellâ€™ordine dovrebbero avere piÃ¹ poteri operativi.", dir:"R"},
    {id:"6_6", text:"La giustizia dovrebbe essere piÃ¹ rapida, anche a costo di ridurre le garanzie.", dir:"R"},
    {id:"6_7", text:"Chi commette reati economici (corruzione, frode fiscale o riciclaggio) dovrebbe ricevere pene severe e reali.", dir:"L"},
    {id:"6_8", text:"I magistrati dovrebbero essere piÃ¹ controllati dal potere politico.", dir:"R"},
    {id:"6_9", text:"La sicurezza collettiva giustifica un controllo piÃ¹ invasivo da parte dello Stato sulla vita privata dei cittadini.", dir:"R"}
  ]},

  /* AREA 7 â€” ETICA, TECNOLOGIA E CULTURA */
  { id:7, title:"AREA 7 â€” ETICA, TECNOLOGIA E CULTURA", qs:[
    {id:"7_1", text:"Lâ€™intelligenza artificiale deve essere regolata dallo Stato per evitare abusi.", dir:"L"},
    {id:"7_2", text:"La religione cattolica ha un ruolo importante nella cultura italiana.", dir:"R"},
    {id:"7_3", text:"Le fake news dovrebbero essere perseguite per legge.", dir:"L"},
    {id:"7_4", text:"Lâ€™arte e la cultura dovrebbero ricevere piÃ¹ fondi pubblici.", dir:"L"},
    {id:"7_5", text:"La libertÃ  di espressione deve essere assoluta, anche per opinioni offensive.", dir:"R"},
    {id:"7_6", text:"Le piattaforme digitali dovrebbero pagare piÃ¹ tasse in Italia.", dir:"L"},
    {id:"7_7", text:"Le tradizioni locali vanno tutelate contro lâ€™omologazione globale.", dir:"R"},
    {id:"7_8", text:"La scienza deve prevalere su ogni credo religioso nelle decisioni pubbliche.", dir:"L"},
    {id:"7_9", text:"Lâ€™intelligenza artificiale e lâ€™automazione devono essere rigidamente regolamentate, anche se questo rallenta lâ€™innovazione.", dir:"L"}
  ]},

  /* AREA 8 â€” INNOVAZIONE SOCIALE E FUTURO */
  { id:8, title:"AREA 8 â€” INNOVAZIONE SOCIALE E FUTURO", qs:[
    {id:"8_1", text:"Il reddito di base universale Ã¨ una buona soluzione per il futuro del lavoro.", dir:"L"},
    {id:"8_2", text:"Lâ€™automazione va tassata per finanziare la disoccupazione tecnologica.", dir:"L"},
    {id:"8_3", text:"Le universitÃ  dovrebbero essere gratuite per i meritevoli.", dir:"N"},
    {id:"8_4", text:"Le start-up dovrebbero ricevere piÃ¹ incentivi pubblici.", dir:"L"},
    {id:"8_5", text:"Il lavoro da remoto va favorito anche nel pubblico impiego.", dir:"L"},
    {id:"8_6", text:"Lâ€™intelligenza artificiale va usata per migliorare i servizi pubblici.", dir:"L"},
    {id:"8_7", text:"Le aziende devono rendere pubblici gli impatti ambientali e sociali.", dir:"L"},
    {id:"8_8", text:"Le politiche per i giovani devono essere prioritarie rispetto a quelle per gli anziani.", dir:"L"},
    {id:"8_9", text:"Una leadership forte e decisionista Ã¨ preferibile a un sistema piÃ¹ lento ma partecipativo e pluralista.", dir:"R"}
  ]},

  /* AREA 9 â€” ETICA, MORALE E RESPONSABILITÃ€ PUBBLICA (versione bilanciata e profonda) */
  { id:9, title:"AREA 9 â€” ETICA, MORALE E RESPONSABILITÃ€ PUBBLICA", qs:[
    {id:"9_1", text:"Le decisioni politiche devono seguire principi morali, anche quando ciÃ² comporta costi economici o impopolaritÃ .", dir:"R"},
    {id:"9_2", text:"La moralitÃ  pubblica deve basarsi su principi universali e laici, piÃ¹ che su valori religiosi o tradizionali.", dir:"L"},
    {id:"9_3", text:"Un politico deve essere giudicato piÃ¹ per la sua coerenza etica che per i risultati pratici ottenuti.", dir:"L"},
    {id:"9_4", text:"Lo Stato deve promuovere comportamenti morali come il rispetto, lâ€™onestÃ  e la solidarietÃ .", dir:"R"},
    {id:"9_5", text:"Il bene comune deve prevalere sugli interessi individuali.", dir:"L"},
    {id:"9_6", text:"La trasparenza politica Ã¨ una questione prima di tutto etica, non solo di efficienza democratica.", dir:"L"},
    {id:"9_7", text:"La morale pubblica deve evolversi nel tempo, seguendo i cambiamenti della societÃ .", dir:"L"},
    {id:"9_8", text:"I cittadini hanno un dovere morale di partecipare alla vita politica e civile.", dir:"L"},
    {id:"9_9", text:"Le scelte etiche in politica devono basarsi piÃ¹ sulla coscienza personale che solo sulla legge.", dir:"L"}
  ]}
];

/* ================= render form ================= */
const form = document.getElementById('form');
areas.forEach(area=>{
  const ad = document.createElement('div'); ad.className='area';
  const h = document.createElement('h2'); h.textContent = area.title; ad.appendChild(h);
  area.qs.forEach((q, idx)=>{
    const qdiv = document.createElement('div'); qdiv.className='q';
    const p = document.createElement('p'); p.innerHTML = `<strong>${idx+1}.</strong> ${q.text}`;
    const selWrap = document.createElement('div'); selWrap.className='sel';
    const sel = document.createElement('select'); sel.name=q.id;
    const opt0 = document.createElement('option'); opt0.value=''; opt0.textContent='Seleziona'; sel.appendChild(opt0);
    for(let v=1; v<=5; v++){ const o=document.createElement('option'); o.value=v; o.textContent=v; sel.appendChild(o); }
    selWrap.appendChild(sel);
    qdiv.appendChild(p); qdiv.appendChild(selWrap);
    ad.appendChild(qdiv);
  });
  form.appendChild(ad);
});

/* ================= helper & calc ================= */
function readAnswers(){
  const out = {};
  areas.forEach(a=> a.qs.forEach(q=>{ const v = document.querySelector(`[name="${q.id}"]`)?.value; out[q.id] = v ? Number(v) : null; }));
  return out;
}
function invertIfNeeded(v, dir){
  if(v===null) return null;
  return dir==='L' ? 6 - v : v;
}

/* full profile texts (as agreed) */
const fullProfiles = {
  Progressista: { title: "Progressista / Socialdemocratico", desc: `Credi in una societÃ  in cui lo Stato svolge un ruolo centrale per garantire uguaglianza, diritti e solidarietÃ .
Sostieni politiche economiche redistributive, con tassazione progressiva e investimenti pubblici in sanitÃ , scuola e welfare.
Ritieni che lâ€™impresa debba avere una funzione sociale e che il lavoro vada tutelato come diritto, non solo come mercato.
In politica estera appoggi la cooperazione europea e le alleze basate sui diritti umani.
Sul piano ambientale dai prioritÃ  alla sostenibilitÃ , anche a costo di limitare la crescita economica.
Vedi lâ€™immigrazione come risorsa culturale e demografica, e credi nellâ€™inclusione e nello ius soli.
In giustizia sei garantista: la prevenzione sociale Ã¨ piÃ¹ importante della sola repressione.
In cultura e innovazione vedi la scienza e la conoscenza come motori di progresso collettivo.` },
  Riformista: { title: "Riformista / Liberale", desc: `Credi nella libertÃ  individuale come valore fondamentale e nel ruolo regolatore ma limitato dello Stato.
Sostieni la concorrenza, lâ€™imprenditorialitÃ  e la responsabilitÃ  personale, ma con attenzione allâ€™equitÃ  e allâ€™inclusione.`},
  Conservatore: { title: "Conservatore / Liberal-conservatore", desc: `Dai importanza allâ€™ordine, alla stabilitÃ  e ai valori tradizionali. Ritieni che il merito e lâ€™impegno personale debbano essere premiati piuttosto che lâ€™intervento pubblico`},
  Sovranista: { title: "Sovranista / Nazional-popolare", desc: `PrioritÃ  alla sovranitÃ  nazionale, tutela dei lavoratori e difesa delle produzioni locali.`},
  Ecologista: { title: "Ecologista / Verde", desc: `La tutela ambientale Ã¨ prioritaria; sostieni la transizione energetica e modelli di sviluppo sostenibili.`},
  Libertario: { title: "Libertario / Individualista", desc: `Massima libertÃ  personale ed economica; minimo intervento statale.`},
  Tecnocratico: { title: "Tecnocratico / Pragmatico", desc: `Fiducia nella competenza e nelle soluzioni tecniche, prioritÃ  a efficienza e governabilitÃ .`},
  Comunitario: { title: "Comunitario / Sociale", desc: `Valorizzi cooperazione locale, mutualismo e politiche di prossimitÃ .`},
  Populista: { title: "Populista / Antisistema", desc: `Critica delle Ã©lite, centralitÃ  del popolo e richieste di maggiore trasparenza.`}
};

/* archetype vectors (0..100) for matching */
const archetypes = [
  {key:'Progressista', vec:[10,10,20,10,10,20,20,10,15]},
  {key:'Riformista', vec:[30,30,40,35,40,30,35,30,30]},
  {key:'Conservatore', vec:[70,70,60,60,65,70,65,50,60]},
  {key:'Sovranista', vec:[80,80,75,80,85,80,80,70,80]},
  {key:'Ecologista', vec:[20,30,25,10,25,30,30,15,20]},
  {key:'Libertario', vec:[85,80,75,80,85,75,70,85,80]},
  {key:'Comunitario', vec:[25,25,30,30,25,35,30,25,25]},
  {key:'Tecnocratico', vec:[45,40,50,40,40,45,45,40,45]},
  {key:'Populista', vec:[60,60,65,55,70,60,60,55,60]}
];

function computeAreaScores(){
  const answers = readAnswers();
  const areaScores = areas.map(area=>{
    let sum=0,cnt=0;
    area.qs.forEach(q=>{
      const v = answers[q.id];
      if(v!==null){ sum += invertIfNeeded(v,q.dir); cnt++; }
    });
    if(cnt===0) return {avgRaw:null,norm:null,answered:0};
    const avgRaw = sum/cnt;
    const norm = Math.round(((avgRaw - 1)/4)*100); // 0..100
    return {avgRaw,norm,answered:cnt};
  });
  return {areaScores,answers};
}

function distance(a,b){
  let sum=0,cnt=0;
  for(let i=0;i<a.length;i++){
    if(a[i]===null || b[i]===null) continue;
    const d=a[i]-b[i]; sum += d*d; cnt++;
  }
  if(cnt===0) return Infinity;
  return Math.sqrt(sum/cnt);
}

function areaNarrativeLabel(areaTitle, norm){
  if(norm===null) return `Per ${areaTitle.toLowerCase()} non ci sono abbastanza risposte per dare un'indicazione.`;
  if(norm <= 33){
    switch(areaTitle){
      case 'AREA 1 â€” ECONOMIA E LAVORO': return "Preferisci un ruolo attivo dello Stato nellâ€™economia: redistribuzione, tutela del lavoro e politiche industriali orientate al benessere collettivo.";
      case 'AREA 2 â€” STATO, TASSE E WELFARE': return "Sostieni un welfare robusto e tasse progressive per finanziare servizi pubblici universali e protezioni sociali.";
      case 'AREA 3 â€” EUROPA E POLITICA ESTERA': return "Privilegi la cooperazione europea e le soluzioni multilaterali nelle relazioni internazionali.";
      case 'AREA 4 â€” AMBIENTE E SVILUPPO SOSTENIBILE': return "Dai prioritÃ  alla tutela dellâ€™ambiente anche a costo di rallentare la crescita economica.";
      case 'AREA 5 â€” IMMIGRAZIONE E IDENTITÃ€': return "Vedi lâ€™immigrazione come risorsa e auspichi politiche di inclusione e integrazione.";
      case 'AREA 6 â€” GIUSTIZIA, SICUREZZA E LEGALITÃ€': return "Preferisci politiche di prevenzione sociale e misure che puntano alla rieducazione e allâ€™inclusione.";
      case 'AREA 7 â€” ETICA, TECNOLOGIA E CULTURA': return "Sostieni regole e investimenti pubblici per cultura, ricerca e regolazione delle tecnologie a tutela del bene comune.";
      case 'AREA 8 â€” INNOVAZIONE SOCIALE E FUTURO': return "Accogli con favore misure pubbliche per gestire automazione e innovazione in modo equo, come investimenti per i giovani e per la formazione.";
      case 'AREA 9 â€” ETICA, MORALE E RESPONSABILITÃ€ PUBBLICA': return "Attribuisci grande importanza alla coerenza etica, alla responsabilitÃ  pubblica e alla trasparenza come criteri fondamentali per giudicare la politica.";
      default: return "";
    }
  } else if(norm <= 66){
    switch(areaTitle){
      case 'AREA 1 â€” ECONOMIA E LAVORO': return "Cerchi un equilibrio tra dinamica di mercato e tutele sociali: interventi mirati dello Stato e spinta allâ€™innovazione.";
      case 'AREA 2 â€” STATO, TASSE E WELFARE': return "Prediligi soluzioni miste: servizi pubblici efficienti e sostenibilitÃ  delle finanze pubbliche.";
      case 'AREA 3 â€” EUROPA E POLITICA ESTERA': return "Sei favorevole a cooperazione internazionale, con attenzione alle autonomie nazionali e alle scelte pragmatiche.";
      case 'AREA 4 â€” AMBIENTE E SVILUPPO SOSTENIBILE': return "Vogli conciliare sostenibilitÃ  e competitivitÃ , adottando soluzioni graduali e tecnologiche.";
      case 'AREA 5 â€” IMMIGRAZIONE E IDENTITÃ€': return "Sostieni regole chiare per accoglienza e integrazione, bilanciando sicurezza e solidarietÃ .";
      case 'AREA 6 â€” GIUSTIZIA, SICUREZZA E LEGALITÃ€': return "Cerchi un bilanciamento tra sicurezza e garanzie processuali, con attenzione allâ€™efficienza giudiziaria.";
      case 'AREA 7 â€” ETICA, TECNOLOGIA E CULTURA': return "Vuoi proteggere libertÃ  individuali e investire in cultura e ricerca, con regole ragionevoli per il digitale.";
      case 'AREA 8 â€” INNOVAZIONE SOCIALE E FUTURO': return "Accogli lâ€™innovazione purchÃ© governata: incentivi mirati e formazione per affrontare i cambiamenti.";
      case 'AREA 9 â€” ETICA, MORALE E RESPONSABILITÃ€ PUBBLICA': return "Mostri attenzione alla responsabilitÃ  etica ma bilanciata con pragmatismo e tutela delle libertÃ  individuali.";
      default: return "";
    }
  } else {
    switch(areaTitle){
      case 'AREA 1 â€” ECONOMIA E LAVORO': return "Preferisci che il mercato guidi lâ€™economia: meno vincoli per le imprese e incentivi alla competitivitÃ .";
      case 'AREA 2 â€” STATO, TASSE E WELFARE': return "Privilegi la riduzione fiscale e politiche che promuovono responsabilitÃ  individuale e efficienza del settore privato.";
      case 'AREA 3 â€” EUROPA E POLITICA ESTERA': return "Sei piÃ¹ orientato alla sovranitÃ  nazionale e a scelte autonome, anche a scapito di accordi internazionali vincolanti.";
      case 'AREA 4 â€” AMBIENTE E SVILUPPO SOSTENIBILE': return "Sei scettico sulle regolazioni ambientali che penalizzano la crescita: prediligi soluzioni che tutelino occupazione e imprese.";
      case 'AREA 5 â€” IMMIGRAZIONE E IDENTITÃ€': return "Dai prioritÃ  al controllo delle frontiere, alla sicurezza e alla tutela dellâ€™identitÃ  nazionale.";
      case 'AREA 6 â€” GIUSTIZIA, SICUREZZA E LEGALITÃ€': return "Ritieni fondamentale ordine e certezza della pena; preferisci approcci piÃ¹ repressivi per la sicurezza pubblica.";
      case 'AREA 7 â€” ETICA, TECNOLOGIA E CULTURA': return "Sostieni libertÃ  dâ€™espressione e tutela delle tradizioni; sei favorevole a limitare interventi pubblici invasivi nel campo culturale.";
      case 'AREA 8 â€” INNOVAZIONE SOCIALE E FUTURO': return "Preferisci approcci che favoriscano imprese e innovazione con minore intervento pubblico diretto.";
      case 'AREA 9 â€” ETICA, MORALE E RESPONSABILITÃ€ PUBBLICA': return "Ritieni che i valori tradizionali, lâ€™ordine e la stabilitÃ  morale siano fondamentali per la qualitÃ  politica.";
      default: return "";
    }
  }
}

/* main calculation and UI rendering */
const TOTAL_Q = areas.reduce((s,a)=> s + a.qs.length, 0);
const MIN_RATIO = 0.60; // internal threshold (not shown to user)

document.getElementById('calc').addEventListener('click', (e)=>{
  e.preventDefault();
  const {areaScores,answers} = computeAreaScores();
  const totalAnswered = areaScores.reduce((s,a)=> s + (a.answered || 0), 0);

  if(totalAnswered / TOTAL_Q < MIN_RATIO){
    alert("Per fornire un profilo affidabile abbiamo bisogno di piÃ¹ risposte. Completa ulteriori affermazioni e poi riprova.");
    return;
  }

  const areaVec = areaScores.map(a => a.norm === null ? null : a.norm);
  const dists = archetypes.map((ar, idx)=>({idx, dist: distance(areaVec, ar.vec)})).sort((a,b)=>a.dist - b.dist);
  const primaryIdx = dists[0].idx;
  const secondaryIdx = dists[1] ? dists[1].idx : null;

  const primaryKey = archetypes[primaryIdx].key;
  const secondaryKey = secondaryIdx !== null ? archetypes[secondaryIdx].key : null;

  const profileMap = {
    'Progressista': fullProfiles.Progressista,
    'Riformista': fullProfiles.Riformista,
    'Conservatore': fullProfiles.Conservatore,
    'Sovranista': fullProfiles.Sovranista,
    'Ecologista': fullProfiles.Ecologista,
    'Libertario': fullProfiles.Libertario,
    'Comunitario': fullProfiles.Comunitario,
    'Tecnocratico': fullProfiles.Tecnocratico,
    'Populista': fullProfiles.Populista
  };

  const primaryProfile = profileMap[primaryKey] || {title:primaryKey, desc:''};
  const secondaryProfile = secondaryKey ? (profileMap[secondaryKey] || {title:secondaryKey, desc:''}) : null;

  let areaNarrativeHTML = '';
  areas.forEach((area, i)=>{
    const norm = areaScores[i].norm;
    const sentence = areaNarrativeLabel(area.title, norm);
    areaNarrativeHTML += `<li><strong>${area.title.replace('AREA ','')}</strong>: ${sentence}</li>`;
  });

  const res = document.getElementById('result');
  res.style.display = 'block';
  res.innerHTML = `
    <h3 class="profileTitle">Profilo corrispondente: ${primaryProfile.title}</h3>
    <p class="profileDesc">${primaryProfile.desc.replace(/\n/g,'<br>')}</p>

    <h4 style="margin-top:12px">Profilo piÃ¹ affine: ${secondaryProfile ? secondaryProfile.title : 'â€”'}</h4>
    <p style="margin:6px 0">${secondaryProfile ? secondaryProfile.desc.replace(/\n/g,'<br>') : ''}</p>

    <h4 style="margin-top:12px">Sintesi per area (descrittiva)</h4>
    <ul class="areaSummary">${areaNarrativeHTML}</ul>

    <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
      <button id="dlPDF">Scarica risultato (PDF)</button>
      <button id="share">Genera link di condivisione</button>
    </div>
  `;

  document.getElementById('dlPDF').addEventListener('click', async ()=>{
    if(typeof window.jspdf === 'undefined'){
      await new Promise((ok,fail)=>{ const s=document.createElement('script'); s.src='https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js'; s.onload=ok; s.onerror=fail; document.head.appendChild(s); }).catch(()=>{ alert('Impossibile caricare libreria PDF'); return; });
    }
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(12);
    doc.text('Risultato Test Orientamento Politico', 14, 20);
    doc.setFontSize(11);
    doc.text(`Profilo: ${primaryProfile.title}`, 14, 30);
    doc.setFontSize(10);
    doc.text(doc.splitTextToSize(primaryProfile.desc, 180), 14, 36);
    if(secondaryProfile){
      doc.addPage();
      doc.setFontSize(11);
      doc.text(`Profilo piÃ¹ affine: ${secondaryProfile.title}`, 14, 20);
      doc.setFontSize(10);
      doc.text(doc.splitTextToSize(secondaryProfile.desc, 180), 14, 26);
    }
    doc.save('profilo_politico.pdf');
  });

  document.getElementById('share').addEventListener('click', ()=>{
    const payload = {v:1,t:Date.now(),a:answers};
    const b64 = btoa(unescape(encodeURIComponent(JSON.stringify(payload)))).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
    const url = `${location.origin}${location.pathname}#r=${b64}`;
    navigator.clipboard?.writeText(url).then(()=> alert('Link copiato negli appunti.')).catch(()=> prompt('Copia questo link:', url));
  });

});

/* save/load/reset */
document.getElementById('save').addEventListener('click',(e)=>{ e.preventDefault(); const v=readAnswers(); localStorage.setItem('qp2025',JSON.stringify(v)); alert('Risposte salvate localmente.');});
document.getElementById('load').addEventListener('click',(e)=>{ e.preventDefault(); const raw=localStorage.getItem('qp2025'); if(!raw){alert('Nessun salvataggio trovato.');return;} try{ const obj=JSON.parse(raw); Object.keys(obj).forEach(k=>{ const el=document.querySelector(`[name="${k}"]`); if(el) el.value = obj[k]===null ? '' : obj[k]; }); alert('Risposte caricate.'); }catch(err){ alert('Errore caricamento.'); }});
document.getElementById('reset').addEventListener('click',(e)=>{ e.preventDefault(); if(!confirm('Resettare tutte le risposte?')) return; document.querySelectorAll('select').forEach(s=>s.value=''); document.getElementById('result').style.display='none'; localStorage.removeItem('qp2025'); });

/* load from hash (shared link) */
function decodeBase64Url(str){ str = str.replace(/-/g,'+').replace(/_/g,'/'); while(str.length%4) str += '='; try{ return JSON.parse(decodeURIComponent(escape(atob(str)))); }catch(e){return null;} }
window.addEventListener('load', ()=>{
  const h = location.hash || '';
  if(h.startsWith('#r=')){
    const b64 = h.slice(3); const obj = decodeBase64Url(b64);
    if(obj && obj.a){ Object.keys(obj.a).forEach(k=>{ const el=document.querySelector(`[name="${k}"]`); if(el) el.value = obj.a[k]===null ? '' : obj.a[k]; }); document.getElementById('calc').click(); }
  }
});
</script>
</body>
</html>
